---
title: "Code Interpreter"
description: "> Pelajari cara menggunakan Neosantara dan E2B Code Interpreter"
---

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/drive/1r5I11nX5_W6xBKUX-0uPF4S6yjRImVu8?usp=sharing)

## Ikhtisar

Panduan ini menjelaskan cara menggunakan **Neosantara** dan **SDK E2B Code Interpreter** untuk membuat sandbox cloud yang aman yang didukung oleh [Firecracker](https://github.com/firecracker-microvm/firecracker). Sandbox ini menyertakan server Jupyter yang sedang berjalan, yang memungkinkan model bahasa besar (LLM) untuk menjalankan kode Python untuk tugas-tugas seperti analisis dan visualisasi data.

---

## Prasyarat

Untuk memulai, pastikan Kamu memiliki hal-hal berikut:

<Info>
  Daftar di [Neosantara](https://app.neosantara.xyz/api-keys) untuk menerima **kredit awal gratis**. Tidak diperlukan kartu kredit.
</Info>

<Card icon="key" href="https://e2b.dev/docs" title="Dapatkan Kunci API E2B Kamu" horizontal>
  Dapatkan kunci API dari [E2B](https://e2b.dev/docs) untuk menggunakan Code Interpreter.
</Card>

- **Node.js**: Versi 16 atau lebih tinggi.
- **Python**: Versi 3.6 atau lebih tinggi.
- **Paket Python yang Diperlukan**:
  - [`openai`](https://pypi.org/project/openai/): Untuk berinteraksi dengan API Neosantara.
  - [`e2b_code_interpreter`](https://pypi.org/project/e2b-code-interpreter/): Untuk menjalankan kode di sandbox E2B.
  - [`python-dotenv`](https://pypi.org/project/python-dotenv/): Untuk mengelola variabel lingkungan.

---

## Instalasi

Instal paket Python yang diperlukan menggunakan pip:

```bash icon="terminal"
pip install e2b_code_interpreter==1.0.0 python-dotenv openai -q
```

Untuk detail tambahan tentang metode yang tersedia, lihat [dokumentasi E2B](https://e2b.dev/docs/quickstart).

---

## Instruksi Penyiapan

<Steps>
  <Step title="Buat Skrip Python">
    Buat file baru, misalnya `index.py`, untuk menampung kode Kamu. Pastikan file tersebut memiliki ekstensi `.py`.

    <Note>
    Nama skrip dapat disesuaikan (misalnya, `index.py` atau `my_script.py`), tetapi harus berupa file `.py` yang valid.
    </Note>
  </Step>

  <Step title="Konfigurasikan Variabel Lingkungan">
    Buat file `.env` di direktori proyek Kamu untuk menyimpan kunci API Kamu:

    ```env
    NAI_API_KEY=kunci_api_neosantara_kamu
    E2B_API_KEY=kunci_api_e2b_kamu
    ```
    
    Ganti `kunci_api_neosantara_kamu` dan `kunci_api_e2b_kamu` dengan kunci yang diperoleh masing-masing dari [Neosantara](https://app.neosantara.xyz/api-keys) dan [E2B](https://e2b.dev/docs).
  </Step>

  <Step title="Pilih Model">
    Pilih model pembuatan kode dari Neosantara. Opsi yang tersedia meliputi:
    - `nusantara-base` (default)
    - `archipelago-70b`
    - `Llama-3.3-Nemotron-Super-49B`

    Lihat daftar lengkap model di [Model Neosantara](https://www.neosantara.xyz/models).
  </Step>

  <Step title="Informasi Kumpulan Data (Dataset)">
    Code interpreter menggunakan kumpulan data yang terletak di `/home/user/data.csv` dalam sandbox. File CSV tersebut menggunakan koma (`,`) sebagai pemisah dan berisi kolom-kolom berikut:

  | Nama Kolom | Contoh Nilai | Deskripsi |
  | :--- | :--- | :--- |
  | `country` | Argentina, Australia | Nama negara |
  | `Region` | SouthAmerica, Oceania | Wilayah geografis |
  | `Surface area (km2)` | 2780400 | Luas daratan dalam kilometer persegi |
  | `Population in thousands (2017)` | 44271 | Populasi dalam ribuan |
  | `Population density (per km2, 2017)` | 16.2 | Jumlah orang per kilometer persegi |
  | `Sex ratio (m per 100 f, 2017)` | 95.9 | Rasio laki-laki terhadap perempuan |
  | `GDP: Gross domestic product (million current US$)` | 632343 | PDB dalam juta USD |
  | `GDP per capita (current US$)` | 14564.5 | PDB per kapita |
  | `Life expectancy at birth, total (years)` | 76.4 | Rata-rata angka harapan hidup |
  | ... (dan lainnya) |  | Lihat daftar lengkapnya dalam [contoh kode](#contoh-kode). |
  </Step>
</Steps>

---

## Contoh Kode

Di bawah ini adalah lengkap contoh yang menunjukkan cara menyiapkan Code Interpreter, mengunggah kumpulan data, dan membuat visualisasi.

````python icon="python"
import os
from dotenv import load_dotenv
from openai import OpenAI
from e2b_code_interpreter import Sandbox
import re
import json

# Muat variabel lingkungan
load_dotenv()

# Kunci API
NAI_API_KEY = os.getenv("NAI_API_KEY")
E2B_API_KEY = os.getenv("E2B_API_KEY")

# Pemilihan model
MODEL_NAME = 'nusantara-base'

# Prompt sistem untuk LLM
SYSTEM_PROMPT = """Kamu adalah seorang ilmuwan data Python. Kamu diberikan tugas untuk diselesaikan dan Kamu menjalankan kode Python untuk menyelesaikannya.

Information about the csv dataset:
- It's in the `/home/user/data.csv` file
- The CSV file is using , as the delimiter
- It has the following columns (examples included):
    - country: "Argentina", "Australia"
    - Region: "SouthAmerica", "Oceania"
    - Surface area (km2): for example, 2780400
    ... 
    - Life expectancy at birth, total (years): for example, 76.4

Generally, you follow these rules:
- ALWAYS FORMAT YOUR RESPONSE IN MARKDOWN
- ALWAYS RESPOND ONLY WITH CODE IN CODE BLOCK LIKE THIS:
```python
{code}
```
- The Python code runs in a Jupyter notebook.
- Each Python code block is executed in a separate cell.
- Display visualizations using matplotlib or other libraries directly in the notebook.
- You have access to the internet and can make API requests.
- You can read/write files in the sandbox filesystem.
- Install any pip package using `!pip install {package}` if needed.
- All code runs in a secure sandbox environment.
"""

# Fungsi untuk mengeksekusi kode di sandbox
def code_interpret(e2b_code_interpreter, code):
    print("Menjalankan code interpreter...")
    exec = e2b_code_interpreter.run_code(
        code,
        on_stderr=lambda stderr: print("[Code Interpreter] Kesalahan:", stderr),
        on_stdout=lambda stdout: print("[Code Interpreter] Output:", stdout),
    )
    if exec.error:
        print("[KESALAHAN Code Interpreter]", exec.error)
        return None
    return exec.results

# Fungsi untuk mengekstrak kode Python dari respons LLM
def match_code_blocks(llm_response):
    pattern = re.compile(r"```python\s*([\s\S]*?)\s*```")
    match = pattern.search(llm_response)
    return match.group(1) if match else ""

# Fungsi untuk berinteraksi dengan LLM dan mengeksekusi kode
def chat_with_llm(e2b_code_interpreter, user_message):
    print(f"\nPesan pengguna: {user_message}")
    messages = [
        {"role": "system", "content": SYSTEM_PROMPT},
        {"role": "user", "content": user_message},
    ]
    client = OpenAI(api_key=NAI_API_KEY, base_url="https://api.neosantara.xyz/v1")
    response = client.chat.completions.create(model=MODEL_NAME, messages=messages)
    response_message = response.choices[0].message
    python_code = match_code_blocks(response_message.content)
    if python_code:
        return code_interpret(e2b_code_interpreter, python_code)
    else:
        print(f"Tidak ada kode Python yang ditemukan dalam respons.")
        return []

# Fungsi untuk mengunggah kumpulan data ke sandbox
def upload_dataset(code_interpreter):
    print("Mengunggah kumpulan data ke sandbox Code Interpreter...")
    dataset_path = "./data.csv"
    if not os.path.exists(dataset_path):
        raise FileNotFoundError("File kumpulan data tidak ditemukan di ./data.csv")
    try:
        with open(dataset_path, "rb") as f:
            file_buffer = f.read()
            remote_path = code_interpreter.files.write('data.csv', file_buffer)
        print("Kumpulan data diunggah ke:", remote_path)
        return remote_path
    except Exception as error:
        print("Kesalahan selama pengunggahan file:", error)
        raise error

# Eksekusi utama
with Sandbox(api_key=E2B_API_KEY) as code_interpreter:
    # Unggah kumpulan data
    upload_dataset(code_interpreter)
    
    # Contoh tugas: Buat grafik regresi linier
    code_results = chat_with_llm(
        code_interpreter,
        "Buat grafik yang menunjukkan regresi linier PDB per kapita vs. angka harapan hidup dari kumpulan data. Saring nilai yang hilang atau tidak valid.",
    )
    
    if code_results:
        first_result = code_results[0]
        print("Visualisasi berhasil dibuat!")
    else:
        raise Exception("Tidak ada hasil dari code interpreter")

# Tampilkan visualisasi (misalnya, output PNG)
first_result

````

---

## Menjalankan Kode

1. **Pastikan kumpulan data** (`data.csv`) berada di direktori yang sama dengan skrip Kamu.
2. **Jalankan skrip** menggunakan:

   ```bash icon="terminal"
   python index.py
   ```

3. **Lihat output**: Skrip mengunggah kumpulan data, mengirimkan tugas ke LLM, mengeksekusi kode Python yang dihasilkan di sandbox, dan menampilkan hasilnya (misalnya, grafik).

### Contoh Output

Tugas contoh tersebut menghasilkan plot sebar dengan garis regresi linier yang menunjukkan hubungan antara PDB per kapita dan angka harapan hidup, yang telah disaring untuk data yang valid.

![Hasil Gambar](/images/result.png)

---

## Fitur Utama

- **Sandbox Aman**: Kode berjalan di lingkungan terisolasi yang didukung oleh Firecracker.
- **Integrasi Jupyter**: Eksekusi kode Python di buku catatan Jupyter di dalam sandbox.
- **Visualisasi Data**: Gunakan pustaka seperti `matplotlib` atau `seaborn` untuk membuat grafik langsung di buku catatan.
- **Akses File**: Baca/tulis file di sistem file sandbox.
- **Dukungan API**: Buat permintaan API dari dalam sandbox.
- **Ekstensibilitas**: Instal paket Python tambahan menggunakan `!pip install`.

---

## Pemecahan Masalah

- **Masalah Kunci API**: Pastikan kunci API Neosantara dan E2B Kamu valid dan disetel dengan benar di file `.env`.
- **Kumpulan Data Tidak Ditemukan**: Verifikasi bahwa `data.csv` ada di direktori skrip.
- **Kesalahan Eksekusi Kode**: Periksa konsol untuk pesan kesalahan dari sandbox (`[KESALAHAN Code Interpreter]`).
- **Kode Python Hilang**: Jika respons LLM tidak memiliki blok kode Python, pastikan prompt Kamu jelas dan spesifik.

Untuk bantuan lebih lanjut, lihat [dokumentasi E2B](https://e2b.dev/docs) atau [dukungan Neosantara](https://www.neosantara.xyz/contact).
